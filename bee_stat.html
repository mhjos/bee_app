<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bee App - Bee Stats</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { font-size: 2em; font-weight: bold; }
    button { margin: 10px 0; padding: 10px 20px; font-size: 1em; }

    /* Modal styling */
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1000; 
        left: 0; top: 0; width: 100%; height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
        background-color: #fff;
        margin: 15% auto; 
        padding: 20px; 
        border: 1px solid #888;
        width: 300px; 
        border-radius: 8px;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
    }
    ul { list-style-type: none; padding: 0; }
    li { margin: 10px 0; cursor: pointer; color: blue; text-decoration: underline; }
</style>
</head>
<body>

<h1 id="beeNameHeader"></h1>
<p>Pollen: <span id="beePollen"></span></p>

<button onclick="showHivesModal()">Going to a hive?</button>
<button onclick="logout()">Fly away</button>

<!-- Modal -->
<div id="hivesModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeHivesModal()">&times;</span>
        <h3>Select a Hive</h3>
        <ul id="hivesList"></ul>
    </div>
</div>

<script>
let beeId = sessionStorage.getItem('bee_id');
let beeName = sessionStorage.getItem('bee_name');
let beePollen = sessionStorage.getItem('bee_pollen');

if (!beeId) {
    window.location.href = '/';
} else {
    document.getElementById('beeNameHeader').innerText = `${beeName} the bee`;
    document.getElementById('beePollen').innerText = beePollen;
}

// ---- Hives modal ----
function showHivesModal() {
    document.getElementById('hivesModal').style.display = 'block';
    loadHives();
}

function closeHivesModal() {
    document.getElementById('hivesModal').style.display = 'none';
}

// Load hives into modal
async function loadHives() {
    const res = await fetch('/hives');
    const hives = await res.json();
    const list = document.getElementById('hivesList');
    list.innerHTML = '';
    hives.forEach(h => {
        const li = document.createElement('li');
        li.innerText = h.name;
        li.onclick = () => {
            sessionStorage.setItem('selected_hive_id', h.id);
            sessionStorage.setItem('selected_hive_name', h.name);
            window.location.href = '/hive_stat';
        };
        list.appendChild(li);
    });
}

// ---- Log out ----
async function logout() {
    await fetch('/logout', { method: 'POST' });
    sessionStorage.clear();
    window.location.href = '/';
}

// Close modal if clicked outside
window.onclick = function(event) {
    const modal = document.getElementById('hivesModal');
    if (event.target == modal) {
        closeHivesModal();
    }
}
</script>

</body>
</html>
